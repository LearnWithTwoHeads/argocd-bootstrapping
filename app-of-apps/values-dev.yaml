# Global configuration for all applications
global:
  # Default source repository URL
  repoURL: https://github.com/learnwithtwoheads/argocd-bootstrapping.git
  # Target revision (branch, tag, or commit)
  targetRevision: main
  # Default destination cluster
  destination:
    server: https://kubernetes.default.svc
    # Default namespace (can be overridden per application)
    namespace: default

# ArgoCD project to deploy applications to
project: default

# List of applications to deploy
applications:
  - name: kubernetes-event-exporter
    targetRevision: 3.6.3
    repoURL: registry-1.docker.io/bitnamicharts/kubernetes-event-exporter
    path: .
    namespace: monitoring
    helm:
      releaseName: kubernetes-event-exporter
      valuesObject:
        extraEnvVars:
        - name: SLACK_TOKEN
          valueFrom:
            secretKeyRef:
              name: slack
              key: token
        config:
          logLevel: debug
          logFormat: json
          maxEventAgeSeconds: 10
          kubeQPS: 60
          kubeBurst: 60
          route:
            routes:
              - match:
                  - kind: "Application"
                    apiVersion: "argoproj.io/v1alpha1"
                    receiver: "slack"
                    type: "Normal"
                    reason: "ImagesUpdated"
          receivers:
            - name: "slack"
              slack:
                token: "${SLACK_TOKEN}"
                channel: "#general"
                message: "Received a Kubernetes Event {{ .Message}}"
                fields:
                  message: "{{ .Message }}"
                  namespace: "{{ .Namespace }}"
                  reason: "{{ .Reason }}"
                  object: "{{ .Namespace }}"

  - name: typescript-app
    # Optional: Override global repository URL
    # repoURL: https://github.com/different-org/app1.git
    # Optional: Override target revision
    # targetRevision: v1.0.0
    # Path within the repository
    path: applications/typescript-app/overlays/dev
    # Optional: Override destination namespace
    # namespace: app1-namespace
    # Optional: Additional annotations for this application
    namespace: dev
    annotations:
      argocd-image-updater.argoproj.io/image-list: typescript=ghcr.io/learnwithtwoheads/sample-projects/typescript-nodejs-server
      argocd-image-updater.argoproj.io/write-back-method: git:secret:argocd/git-creds
      argocd-image-updater.argoproj.io/git-branch: main
      argocd-image-updater.argoproj.io/update-strategy: newest-build
      argocd-image-updater.argoproj.io/pull-secret: pullsecret:argocd/github-pull
      # notifications.argoproj.io/subscribe.on-sync-succeeded.slack: gitops-notifications
    # Optional: Additional labels
    labels:
      # environment: production
      # team: backend
    # Optional: Sync policy override
    syncPolicy:
      automated:
        prune: true
        selfHeal: true
      syncOptions:
        - CreateNamespace=true

# Default sync policy for all applications (can be overridden per app)
defaultSyncPolicy:
  automated:
    prune: true
    selfHeal: true
  syncOptions:
    - CreateNamespace=true
    - PruneLast=true

# Default retry policy
defaultRetryPolicy:
  limit: 5
  backoff:
    duration: 5s
    factor: 2
    maxDuration: 3m
